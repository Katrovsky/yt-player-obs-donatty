<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube Player Overlay</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:transparent;display:flex;align-items:center;justify-content:center;height:100vh;color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;overflow:hidden;}
.container{text-align:center;max-width:400px;width:100%;padding:5px;}
#player-wrapper{position:relative;overflow:hidden;opacity:0;transition:opacity 0.5s ease;}
#player{width:400px;height:225px;margin:0 auto;aspect-ratio:16/9;}
#player-wrapper.visible{opacity:1;}
</style>
<script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
<div class="container"><div id="player-wrapper"><div id="player"></div></div></div>
<script>
let player,currentVideo='',ws,reconnectTimer;
function onYouTubeIframeAPIReady(){player=new YT.Player('player',{videoId:'',playerVars:{autoplay:1,controls:0,rel:0,modestbranding:1,fs:0,iv_load_policy:3},events:{'onStateChange':onPlayerStateChange,'onError':onPlayerError}});connectWebSocket();}
function connectWebSocket(){ws=new WebSocket('ws://'+location.host+'/ws');ws.onopen=()=>{clearTimeout(reconnectTimer);};ws.onmessage=e=>{try{const d=JSON.parse(e.data);updateUI(d);}catch(err){}};ws.onclose=()=>{reconnectTimer=setTimeout(connectWebSocket,3000);};ws.onerror=err=>{};}
function updateUI(d){const t=d.current;const a=d.action;if(!player)return;const wrapper=document.getElementById('player-wrapper');if(!t){if(currentVideo){player.stopVideo();currentVideo='';}wrapper.classList.remove('visible');return;}if(t.video_id!==currentVideo){player.loadVideoById(t.video_id);currentVideo=t.video_id;}if(a==='paused'){player.pauseVideo();wrapper.classList.remove('visible');}else if(a==='stopped'){player.stopVideo();wrapper.classList.remove('visible');}else if(a==='playing'){player.playVideo();wrapper.classList.add('visible');}}
function onPlayerStateChange(event){if(event.data===YT.PlayerState.ENDED){fetch('/api/next',{method:'POST'}).catch(console.error);}}
function onPlayerError(event){setTimeout(()=>{fetch('/api/next',{method:'POST'}).catch(console.error);},2000);}
</script>
</body>
</html>