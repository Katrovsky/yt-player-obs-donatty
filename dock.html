<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Player Dock</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=DM+Mono:wght@400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:       #0f0f11;
    --surface:  #17171a;
    --surface2: #1e1e22;
    --border:   #2a2a30;
    --border2:  #333339;
    --txt:      #e8e8ed;
    --txt2:     #7e7e8f;
    --txt3:     #4a4a58;
    --accent:   #5b6af0;
    --amber:    #f59e0b;
    --red:      #f04f4f;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--txt);
    font-family: 'DM Sans', sans-serif;
    padding: 8px;
  }

  .track-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 12px;
    margin-bottom: 8px;
  }

  .track-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .track-row + .track-row {
    margin-top: 7px;
    padding-top: 7px;
    border-top: 1px solid var(--border);
  }

  .track-label {
    font-size: 0.6rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--txt3);
    width: 28px;
    flex-shrink: 0;
  }

  .track-info { flex: 1; min-width: 0; }
  .track-title {
    font-size: 0.8rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .track-by {
    font-size: 0.68rem;
    color: var(--txt2);
    margin-top: 1px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .rm-btn {
    width: 18px; height: 18px;
    border-radius: 4px;
    border: 1px solid var(--border2);
    background: transparent;
    color: var(--txt3);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: border-color 0.12s, color 0.12s;
  }
  .rm-btn:hover { border-color: var(--red); color: var(--red); }

  .controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
  }

  .ctrl {
    width: 36px; height: 32px;
    border-radius: 7px;
    border: 1px solid var(--border2);
    background: var(--surface);
    color: var(--txt2);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    flex-shrink: 0;
    transition: border-color 0.12s, background 0.12s, color 0.12s, transform 0.08s;
  }
  .ctrl:hover { background: var(--surface2); color: var(--txt); }
  .ctrl:active { transform: scale(0.93); }

  .ctrl.play {
    width: 48px;
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }
  .ctrl.play:hover { background: #4a59e0; border-color: #4a59e0; }
  .ctrl.play.paused { background: var(--amber); border-color: var(--amber); color: #fff; }
  .ctrl.play.paused:hover { background: #d97706; border-color: #d97706; }
</style>
</head>
<body>

<div class="track-card">
  <div class="track-row">
    <span class="track-label">Now</span>
    <div class="track-info">
      <div class="track-title" id="npTitle">—</div>
      <div class="track-by" id="npBy">—</div>
    </div>
  </div>
  <div class="track-row" id="nextRow" style="display:none">
    <span class="track-label">Next</span>
    <div class="track-info">
      <div class="track-title" id="nxTitle">—</div>
      <div class="track-by" id="nxBy">—</div>
    </div>
    <button class="rm-btn" onclick="api.rm(0)">
      <svg width="8" height="8" viewBox="0 0 24 24" fill="none">
        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
      </svg>
    </button>
  </div>
</div>

<div class="controls">
  <div class="ctrl" onclick="api.cmd('previous')">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
      <path d="M19 18V6L9 12L19 18ZM21 18V6H19V18H21Z" fill="currentColor"/>
    </svg>
  </div>
  <div class="ctrl play" id="ppBtn" onclick="api.pp()">
    <svg id="ppIcon" width="14" height="14" viewBox="0 0 24 24" fill="none">
      <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
    </svg>
  </div>
  <div class="ctrl" onclick="api.cmd('next')">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
      <path d="M5 18V6L15 12L5 18ZM3 18V6H5V18H3Z" fill="currentColor"/>
    </svg>
  </div>
</div>

<script>
let ws, currSt = 'stopped';
const base = window.location.origin;

const api = {
  async fetch(path) {
    try { const r = await fetch(base + path, { method: 'POST' }); return await r.json(); }
    catch (e) { return { success: false }; }
  },
  async cmd(c) { await this.fetch(`/api/${c}`); },
  async pp() { await this.cmd(currSt === 'playing' ? 'pause' : 'play'); },
  async rm(i) { await this.fetch(`/api/remove?index=${i}`); },
};

function update(d) {
  currSt = d.action || 'stopped';
  const t = d.current;
  const qu = d.queue || [];
  const pos = d.position || 0;

  document.getElementById('npTitle').textContent = t ? t.title : '—';
  document.getElementById('npBy').textContent    = t ? (t.added_by || 'Unknown') : '—';

  const next = qu[pos + 1];
  const nextRow = document.getElementById('nextRow');
  if (next) {
    nextRow.style.display = 'flex';
    document.getElementById('nxTitle').textContent = next.title;
    document.getElementById('nxBy').textContent    = next.added_by || 'Unknown';
  } else {
    nextRow.style.display = 'none';
  }

  const btn  = document.getElementById('ppBtn');
  const icon = document.getElementById('ppIcon');
  if (currSt === 'playing') {
    btn.classList.remove('paused');
    icon.innerHTML = '<path d="M14 19V5H18V19H14ZM6 19V5H10V19H6Z" fill="currentColor"/>';
  } else {
    btn.classList.add('paused');
    icon.innerHTML = '<path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>';
  }
}

function connect() {
  ws = new WebSocket('ws://' + location.host + '/ws');
  ws.onmessage = e => { try { update(JSON.parse(e.data)); } catch (_) {} };
  ws.onclose   = () => setTimeout(connect, 3000);
  ws.onerror   = () => {};
}

window.addEventListener('load', connect);
</script>
</body>
</html>